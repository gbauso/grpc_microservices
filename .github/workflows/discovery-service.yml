name: Discovery Master

on:
  push:
    paths:
      - .github/workflows/discovery-service.yml
      - discovery-service/**
      - discovery-service/grpc_gen/**
defaults:
 run:
  working-directory: ./discovery-service      

jobs:
  push_to_registry:
    runs-on: ubuntu-latest
    steps:
			- uses: actions/checkout@v3
				with:
					submodules: true
			- uses: actions/setup-go@v3
				with:
					go-version: 1.18.x
			- name: test_code
				run: go test ./... -cover -coverprofile=coverage.out
			- name: send_to_codecov
				uses: codecov/codecov-action@v2
				with:
					files: coverage.out
					directory: ./discovery-service 
					root_dir: ./discovery-service 
					flags: discovery-service 
					name: grpc_microservices 
					verbose: true 
			- name: Determine Version
				uses: gittools/actions/gitversion/execute@v0.9.11
				id: gitversion
				with:
					useConfigFile: true
					configFilePath: 'GitVersion.yml'
			- name: echo version
				run: echo ${{ steps.gitversion.outputs.SemVer }}
     

