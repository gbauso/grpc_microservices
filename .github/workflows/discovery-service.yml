name: Discovery Service

on:
  push:
    paths:
      - .github/workflows/discovery-service.yml
      - discovery-service/**
      - discovery-service/grpc_gen/**
	pull-request:
    paths:
      - .github/workflows/discovery-service.yml
      - discovery-service/**
      - discovery-service/grpc_gen/**
defaults:
 run:
  working-directory: ./discovery-service      

jobs:
  push_to_registry:
    runs-on: ubuntu-latest
    steps:
     - name: 'Install GitVersion'
       uses: gittools/actions/gitversion/setup@v0.9.11
       with:
         versionSpec: '5.x'
     - uses: actions/checkout@v3
       with:
        submodules: true
        fetch-depth: 0
     - uses: actions/setup-go@v3
       with:
        go-version: 1.18.x
     - name: test_code
       run: go test ./... -cover -coverprofile=coverage.out
     - name: determine_version
       uses: gittools/actions/gitversion/execute@v0.9.11
       id: gitversion
       with:
         useConfigFile: true
         configFilePath: 'GitVersion.yml'
     - name: echo_version
       run: echo ${{ steps.gitversion.outputs.SemVer }}
     - name: send_to_codecov
       uses: codecov/codecov-action@v2
       with:
        files: coverage.out
        directory: ./discovery-service 
        root_dir: ./discovery-service 
        flags: discovery-service 
        name: grpc_microservices 
        verbose: true
